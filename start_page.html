<%
    var courses_quantity = ArrayCount(XQuery("for $elem in courses return $elem"));
    var learnings_quantity = ArrayCount(XQuery('for $elem in learnings where $elem/person_id = '+ curUserID +' return $elem'));
    var certificates_quantity = ArrayCount(XQuery('for $elem in certificates where $elem/person_id = '+ curUserID +' return $elem'));
    var tests_quantity = ArrayCount(XQuery('for $elem in assessments return $elem'));
    var test_learnings_quantity = ArrayCount(XQuery('for $elem in test_learnings where $elem/person_id = '+ curUserID +'return $elem'));
    var quotes = ArrayDirect(XQuery("for $elem in cc_quotes return $elem"));
    var random_quote = quotes[Random(0, quotes.length - 1)];
    var curUser = ArrayOptFirstElem(XQuery('for $c in collaborators where $c/id = '+ curUserID +'return $c'));
    var main_test = ArrayOptFirstElem(XQuery("for $elem in assessments where contains($elem/title, 'Главный') return $elem"));
    var main_test_result = ArrayOptFirstElem(XQuery("for $t in test_learnings where $t/assessment_id = " + main_test.id + " and $t/state_id = 4 and $t/person_id = " + curUserID + " return $t"));
%>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="/zaes/bootstrap-4.5.3/css/bootstrap.min.css">
    <style type="text/css">
        body {
            overflow: auto;
        }
    </style>
</head>

<%
    if (curUser.email == '') {
%>
        <div class="container row add-email-box" id="add-email-box">
            <label for="add-email">Добавьте электронную почту, чтобы получать уведомления:</label>
            <div>
                <input type="email" id="add-email" class="add-email" placeholder="example@site.com" required>
                <span id="hide"></span>
                <div id="warning-text">Некорректный email</div>
            </div>
            <button type="button" class="btn-save-email" onclick="addEmail()" onblur="lostFocus()">Сохранить</button>
            <button type="button" class="btn-reject-email" onclick="refuseOfNotice()">Не хочу получать уведомления</button>
        </div>
<%
    }
%>

<div class="container tags_container mt-3 container_start_page"> 
    <div class="row main_container container_margin">
        <div class="col-12 col-sm-7 col-md-9">
            <div class="row">
                <div class="col-12 col-sm-12 col-md-12">
                    <div class="card w-100 bg-primary" style="border-radius: 10px;border: 0;box-shadow: 0em 0em 3em rgba(0, 0, 0, 0.1);">
                        <div class="card-body p-0">
                            <div class="slider">
                                <div class="slider-item">
                                    <div style="background-image: url(/zaes/img/banner1.gif);"></div>
                                </div>
                                <div class="slider-item" style="display: none;">
                                    <div style="background-image: url(/zaes/img/banner2.gif);"></div>
                                </div>
                                <div class="slider-item" style="display: none;">
                                    <div style="background-image: url(/zaes/img/banner3.gif);"></div>
                                </div>
                                <div class="slider-item" style="display: none;">
                                    <div style="background-image: url(/zaes/img/banner4.gif);"></div>
                                </div>
                                <a class="previous" onclick="previousSlide()">&#10094;</a>
                                <a class="next" onclick="nextSlide()">&#10095;</a>
                                <div class="pagination">
                                    <div class="pagination-elem" onclick="currentSlide(1)"></div>
                                    <div class="pagination-elem" onclick="currentSlide(2)"></div>
                                    <div class="pagination-elem" onclick="currentSlide(3)"></div>
                                    <div class="pagination-elem" onclick="currentSlide(4)"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row mt-4">
                <div class="col-3 col-sm-3 col-md-4" style="min-width: 260px; margin-bottom: 20px;">
                    <div class="card form-card-style border-0">
                        <div class="card-body pt-3 pb-2 text-left">
                            <h5 class="card-title">Тестирование</h5>
                            <p class="card-text point-style target px-3 py-2">
                                <%
                                    if (main_test_result !== undefined) {
                                %>
                                        <span class="col test-result target p-0" style="color: green;">Тест пройден</span>
                                <%
                                    } else {
                                %>
                                        <span class="col test-result target p-0" style="color: darkred;">Тест не пройден</span>
                                <%
                                    }
                                %>
                            </p>
                        </div>
                    </div>
                </div>
                <div class="col-3 col-sm-3 col-md-4" style="min-width: 260px; margin-bottom: 20px;">
                    <div class="card form-card-style border-0">
                        <div class="card-body pt-3 pb-2 text-left">
                            <h5 class="card-title">Изучено курсов</h5>
                            <p class="card-text point-style target px-3 py-2">
                                <span class="col point-style target p-0 animate1"><%=learnings_quantity%></span>
                                /
                                <span class="col point-style target p-0 animate2"><%=courses_quantity%></span>
                            </p>
                        </div>
                    </div>
                </div>
                <div class="col-4 col-sm-4 col-md-4" style="min-width: 260px; margin-bottom: 20px;">
                    <div class="card form-card-style border-0">
                        <div class="card-body pt-3 pb-2 text-left">
                            <h5 class="card-title">Мои сертификаты</h5>
                            <p class="card-text point-style target px-3 py-2"><%=certificates_quantity%></p>
                        </div>
                    </div>
                </div>
            </div>    
        </div>
        <div class="col-12 col-sm-5 col-md-3 quote_card" style="min-width: 245px;" id="quote_block">
            <div class="card w-100" style="border-radius: 10px;border: 0;box-shadow: 0em 0em 3em rgba(0, 0, 0, 0.1);height: 95%;">
                <div class="card-body poll py-2">
                    <div class="card-body poll py-2">
                        <h5 class="card-title text-primary"><%=random_quote.quote_month%></h5>
                        <br>
                        <p style="font-size: 14px;">
                            <b><%=random_quote.text_bold%></b> <%=random_quote.text_normal%>
                            <br>
                            <br>
                        </p>
                        <p style="text-align:right; font-style: italic; font-size: 12px">
                            <b><%=random_quote.author_name%></b>
                            <br>
                            <%=random_quote.years_of_life%>
                            <br>
                            <%=random_quote.author_profession%>
                        </p>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-12 col-sm-5 col-md-3 feature" style="min-width: 245px; display: none;">
            <div class="card w-100" style="border-radius: 10px;border: 0;box-shadow: 0em 0em 3em rgba(0, 0, 0, 0.1);height: 95%;">
                <div class="card-body poll py-2 feature-card">
                    <div class="card-body poll py-2">
                        <h5 class="card-title text-primary"><%=random_quote.quote_month%></h5>
                        <br>
                        <p style="font-size: 14px;">
                            Когда меня рожали, собственно, тогда я и родился.
                            <br>
                            <br>
                        </p>
                        <p style="text-align:right; font-style: italic; font-size: 12px">
                            <b>Jason Statham</b>
                            <br>
                            1967 - н.в.
                            <br>
                            английский актёр и просто хороший парень
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <p>&nbsp;</p>
</div>

<script src="/zaes/jquery/jquery-3.5.1.min.js"></script>
<script src="/zaes/bootstrap-4.5.3/js/bootstrap.bundle.min.js"></script>
<script src="/zaes/start_page.js"></script>